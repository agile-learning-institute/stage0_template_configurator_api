$schema: "https://stage0/schemas/process.schema.yaml"
$id: "https://stage0/template-mongodb-api/process.yaml"
title: Process file for a MongoDB configurator API template
version: "1.0"

context:
  - key: org
    type: path
    path: product.organization
  - key: catalog
    type: path
    path: catalog

requires:
  - org.name
  - org.founded
  - org.git_host
  - org.git_org
  - org.docker_host
  - org.docker_org
  - product.info.name
  - product.info.description
  - product.info.slug
  - product.info.developer_cli
  - product.info.mongodb_name
  - catalog.dictionaries

templates:
  - path: "./.github/workflows/docker-push.yml"
    merge: true
  - path: "./Dockerfile"
    merge: true
  - path: "./LICENSE"
    merge: true
  - path: "./README.md"
    merge: true

  # Makefile to overwrite Template Makefile
  - path: "./Makefile.template"
    mergeFor:
      items: ["one"]
      output: "./Makefile"

  # Configurations from data_catalog
  - path: "./configurator/configurations/collection.yaml.template"
    mergeFor:
      items: catalog.dictionaries
      output: "./configurator/configurations/{{name}}.{{version}}.yaml"

  # Dictionaries from catalog
  - path: "./configurator/dictionaries/dictionary.yaml.template"
    mergeFor:
      items: catalog.dictionaries
      output: "./configurator/dictionaries/{{name}}.{{version}}.yaml"

  # Test Data from data_catalog
  - path: "./configurator/test_data/types/type.yaml.template"
    mergeFor:
      items: catalog.dictionaries
      output: "./configurator/test_data/types/{{name}}.{{version}}.json"
